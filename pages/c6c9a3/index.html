<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>RabbitMQ | Qouson&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/logo.png">
    <meta name="description" content="Java技术博客,专注Java学习与总结。">
    <meta name="keywords" content="Java后端博客,个人技术博客,后端,后端开发,后端框架,web后端,后端面试题,技术文档,学习,面试,Spring,Spring MVC,Spring Boot,Mybatis,Redis,Kafka,Zookeeper,Dubbo,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.ada71c49.css" as="style"><link rel="preload" href="/assets/js/app.a811c800.js" as="script"><link rel="preload" href="/assets/js/2.06722832.js" as="script"><link rel="preload" href="/assets/js/42.4a6de99f.js" as="script"><link rel="prefetch" href="/assets/js/10.a57c9c9b.js"><link rel="prefetch" href="/assets/js/11.965cea58.js"><link rel="prefetch" href="/assets/js/12.43d06000.js"><link rel="prefetch" href="/assets/js/13.66ce2c61.js"><link rel="prefetch" href="/assets/js/14.c1ec3892.js"><link rel="prefetch" href="/assets/js/15.360b302b.js"><link rel="prefetch" href="/assets/js/16.f5c99d66.js"><link rel="prefetch" href="/assets/js/17.f86eb43c.js"><link rel="prefetch" href="/assets/js/18.33a9e614.js"><link rel="prefetch" href="/assets/js/19.b055d8a6.js"><link rel="prefetch" href="/assets/js/20.1752c0a9.js"><link rel="prefetch" href="/assets/js/21.f338c068.js"><link rel="prefetch" href="/assets/js/22.3dfa9cf8.js"><link rel="prefetch" href="/assets/js/23.74d81a1d.js"><link rel="prefetch" href="/assets/js/24.945f547d.js"><link rel="prefetch" href="/assets/js/25.e49e2741.js"><link rel="prefetch" href="/assets/js/26.d801af92.js"><link rel="prefetch" href="/assets/js/27.567f917f.js"><link rel="prefetch" href="/assets/js/28.a997501a.js"><link rel="prefetch" href="/assets/js/29.e26968d6.js"><link rel="prefetch" href="/assets/js/3.47e90fde.js"><link rel="prefetch" href="/assets/js/30.0b8c4e46.js"><link rel="prefetch" href="/assets/js/31.9c518480.js"><link rel="prefetch" href="/assets/js/32.28515fda.js"><link rel="prefetch" href="/assets/js/33.0cfcf1b9.js"><link rel="prefetch" href="/assets/js/34.4b9600fc.js"><link rel="prefetch" href="/assets/js/35.7a4be827.js"><link rel="prefetch" href="/assets/js/36.f71da370.js"><link rel="prefetch" href="/assets/js/37.3f64a0dd.js"><link rel="prefetch" href="/assets/js/38.efa5b64f.js"><link rel="prefetch" href="/assets/js/39.bde42687.js"><link rel="prefetch" href="/assets/js/4.477da08c.js"><link rel="prefetch" href="/assets/js/40.fab538ad.js"><link rel="prefetch" href="/assets/js/41.0ccec46a.js"><link rel="prefetch" href="/assets/js/43.e653d26d.js"><link rel="prefetch" href="/assets/js/44.3965a686.js"><link rel="prefetch" href="/assets/js/45.bf7693be.js"><link rel="prefetch" href="/assets/js/46.bfafeb08.js"><link rel="prefetch" href="/assets/js/47.83bbe3d6.js"><link rel="prefetch" href="/assets/js/48.f42c945a.js"><link rel="prefetch" href="/assets/js/49.ff2457cb.js"><link rel="prefetch" href="/assets/js/5.12b1503c.js"><link rel="prefetch" href="/assets/js/50.00485604.js"><link rel="prefetch" href="/assets/js/51.24c7d9ea.js"><link rel="prefetch" href="/assets/js/52.5ca4ff53.js"><link rel="prefetch" href="/assets/js/53.bb1586ed.js"><link rel="prefetch" href="/assets/js/54.793cc54f.js"><link rel="prefetch" href="/assets/js/55.b845e6f7.js"><link rel="prefetch" href="/assets/js/56.3eb783da.js"><link rel="prefetch" href="/assets/js/57.7cc78a6e.js"><link rel="prefetch" href="/assets/js/58.f080c773.js"><link rel="prefetch" href="/assets/js/59.9f5d8d5f.js"><link rel="prefetch" href="/assets/js/6.8f2b7579.js"><link rel="prefetch" href="/assets/js/60.a9d3c94a.js"><link rel="prefetch" href="/assets/js/61.bc242f5b.js"><link rel="prefetch" href="/assets/js/7.a987c790.js"><link rel="prefetch" href="/assets/js/8.c07b8e58.js"><link rel="prefetch" href="/assets/js/9.8a94162e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ada71c49.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Qouson's blog" class="logo"> <span class="site-name can-hide">Qouson's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java SE" class="dropdown-title"><a href="/java/" class="link-title">Java SE</a> <span class="title" style="display:none;">Java SE</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java 基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/standard/" class="nav-link">基础</a></li><li class="dropdown-subitem"><a href="/java/string/" class="nav-link">String</a></li></ul></li><li class="dropdown-item"><h4>Java 中级</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/net/" class="nav-link">网络编程</a></li></ul></li><li class="dropdown-item"><h4>Java 高级</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/jvm/" class="nav-link">JVM</a></li><li class="dropdown-subitem"><a href="/java/thread/" class="nav-link">多线程</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring框架" class="dropdown-title"><a href="/spring/" class="link-title">Spring框架</a> <span class="title" style="display:none;">Spring框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/spring/spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/spring/springmvc/" class="nav-link">SpringMVC</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><a href="/midware/" class="link-title">中间件</a> <span class="title" style="display:none;">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/midware/mysql/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/midware/redis/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/midware/mq/" class="nav-link">MQ</a></li><li class="dropdown-item"><!----> <a href="/midware/zookeeper/" class="nav-link">ZooKeeper</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/more/git/" class="nav-link">git</a></li><li class="dropdown-item"><!----> <a href="/more/linux/" class="nav-link">linux</a></li><li class="dropdown-item"><!----> <a href="/more/designpattern/" class="nav-link">设计模式</a></li><li class="dropdown-item"><!----> <a href="/more/datastructure/" class="nav-link">数据结构与算法</a></li></ul></div></div><div class="nav-item"><a href="/javamap/" class="nav-link">Java知识图谱</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/qouson/my-java-note" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="img/lunhua.png"> <div class="blogger-info"><h3>qouson</h3> <span>Java界的小学生</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java SE" class="dropdown-title"><a href="/java/" class="link-title">Java SE</a> <span class="title" style="display:none;">Java SE</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java 基础</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/standard/" class="nav-link">基础</a></li><li class="dropdown-subitem"><a href="/java/string/" class="nav-link">String</a></li></ul></li><li class="dropdown-item"><h4>Java 中级</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/net/" class="nav-link">网络编程</a></li></ul></li><li class="dropdown-item"><h4>Java 高级</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/jvm/" class="nav-link">JVM</a></li><li class="dropdown-subitem"><a href="/java/thread/" class="nav-link">多线程</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring框架" class="dropdown-title"><a href="/spring/" class="link-title">Spring框架</a> <span class="title" style="display:none;">Spring框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/spring/spring/" class="nav-link">Spring</a></li><li class="dropdown-item"><!----> <a href="/spring/springmvc/" class="nav-link">SpringMVC</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><a href="/midware/" class="link-title">中间件</a> <span class="title" style="display:none;">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/midware/mysql/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/midware/redis/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/midware/mq/" class="nav-link">MQ</a></li><li class="dropdown-item"><!----> <a href="/midware/zookeeper/" class="nav-link">ZooKeeper</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/more/git/" class="nav-link">git</a></li><li class="dropdown-item"><!----> <a href="/more/linux/" class="nav-link">linux</a></li><li class="dropdown-item"><!----> <a href="/more/designpattern/" class="nav-link">设计模式</a></li><li class="dropdown-item"><!----> <a href="/more/datastructure/" class="nav-link">数据结构与算法</a></li></ul></div></div><div class="nav-item"><a href="/javamap/" class="nav-link">Java知识图谱</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/qouson/my-java-note" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>mysql</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>redis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>mq</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/1a1fb6/" class="sidebar-link">消息中间件的应用场景</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>ActiveMQ</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>RabbitMQ</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/c6c9a3/" aria-current="page" class="active sidebar-link">RabbitMQ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/c6c9a3/#rabbitmq入门" class="sidebar-link">RabbitMQ入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/c6c9a3/#rabbitmq安装和使用" class="sidebar-link">RabbitMQ安装和使用</a></li><li class="sidebar-sub-header level4"><a href="/pages/c6c9a3/#一、安装依赖环境" class="sidebar-link">一、安装依赖环境</a></li><li class="sidebar-sub-header level4"><a href="/pages/c6c9a3/#二、安装rabbitmq" class="sidebar-link">二、安装RabbitMQ</a></li><li class="sidebar-sub-header level4"><a href="/pages/c6c9a3/#三、启动和关闭" class="sidebar-link">三、启动和关闭</a></li><li class="sidebar-sub-header level4"><a href="/pages/c6c9a3/#四、开启web管理插件" class="sidebar-link">四、开启Web管理插件</a></li><li class="sidebar-sub-header level4"><a href="/pages/c6c9a3/#五、防火墙添加端口" class="sidebar-link">五、防火墙添加端口</a></li><li class="sidebar-sub-header level3"><a href="/pages/c6c9a3/#多机多节点集群部署" class="sidebar-link">多机多节点集群部署</a></li><li class="sidebar-sub-header level4"><a href="/pages/c6c9a3/#一、-环境准备-一、-环境准备" class="sidebar-link">一、 环境准备</a></li><li class="sidebar-sub-header level4"><a href="/pages/c6c9a3/#二、修改配置文件" class="sidebar-link">二、修改配置文件</a></li><li class="sidebar-sub-header level4"><a href="/pages/c6c9a3/#三、防火墙添加端口" class="sidebar-link">三、防火墙添加端口</a></li><li class="sidebar-sub-header level4"><a href="/pages/c6c9a3/#四、启动rabbitmq" class="sidebar-link">四、启动RabbitMQ</a></li><li class="sidebar-sub-header level3"><a href="/pages/c6c9a3/#单机多节点部署" class="sidebar-link">单机多节点部署</a></li><li class="sidebar-sub-header level4"><a href="/pages/c6c9a3/#一、环境准备" class="sidebar-link">一、环境准备</a></li><li class="sidebar-sub-header level4"><a href="/pages/c6c9a3/#二、启动rabbitmq" class="sidebar-link">二、启动RabbitMQ</a></li><li class="sidebar-sub-header level4"><a href="/pages/c6c9a3/#三、防火墙添加端口-2" class="sidebar-link">三、防火墙添加端口</a></li><li class="sidebar-sub-header level3"><a href="/pages/c6c9a3/#镜像队列模式集群" class="sidebar-link">镜像队列模式集群</a></li><li class="sidebar-sub-header level3"><a href="/pages/c6c9a3/#rabbitmq持久化机制" class="sidebar-link">RabbitMQ持久化机制</a></li><li class="sidebar-sub-header level4"><a href="/pages/c6c9a3/#rabbitmq持久化" class="sidebar-link">RabbitMQ持久化</a></li><li class="sidebar-sub-header level4"><a href="/pages/c6c9a3/#rabbitmq内存控制" class="sidebar-link">RabbitMQ内存控制</a></li><li class="sidebar-sub-header level4"><a href="/pages/c6c9a3/#rabbitmq磁盘控制" class="sidebar-link">RabbitMQ磁盘控制</a></li><li class="sidebar-sub-header level3"><a href="/pages/c6c9a3/#消息可靠性和插件化机制" class="sidebar-link">消息可靠性和插件化机制</a></li><li class="sidebar-sub-header level4"><a href="/pages/c6c9a3/#消息可靠性" class="sidebar-link">消息可靠性</a></li><li class="sidebar-sub-header level5"><a href="/pages/c6c9a3/#发送可靠性" class="sidebar-link">发送可靠性</a></li><li class="sidebar-sub-header level5"><a href="/pages/c6c9a3/#消费可靠性" class="sidebar-link">消费可靠性</a></li><li class="sidebar-sub-header level4"><a href="/pages/c6c9a3/#插件化机制" class="sidebar-link">插件化机制</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Kafka</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>zookeeper</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/midware/#中间件" data-v-06225672>中间件</a></li><li data-v-06225672><a href="/midware/#mq" data-v-06225672>mq</a></li><li data-v-06225672><a href="/midware/#RabbitMQ" data-v-06225672>RabbitMQ</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/qouson" target="_blank" title="作者" class="beLink" data-v-06225672>qouson</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-05-23</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">RabbitMQ<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="rabbitmq"><a href="#rabbitmq" class="header-anchor">#</a> <a href="#RabbitMQ">RabbitMQ</a></h1> <h2 id="rabbitmq入门"><a href="#rabbitmq入门" class="header-anchor">#</a> <a href="#RabbitMQ%E5%85%A5%E9%97%A8">RabbitMQ入门</a></h2> <h3 id="rabbitmq安装和使用"><a href="#rabbitmq安装和使用" class="header-anchor">#</a> <a href="#RabbitMQ%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8">RabbitMQ安装和使用</a></h3> <h4 id="一、安装依赖环境"><a href="#一、安装依赖环境" class="header-anchor">#</a> <a href="#%E4%B8%80%E3%80%81%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96%E7%8E%AF%E5%A2%83">一、安装依赖环境</a></h4> <ul><li>1.在 <a href="http://www.rabbitmq.com/which-erlang.html" target="_blank" rel="noopener noreferrer">http://www.rabbitmq.com/which-erlang.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 页面查看安装rabbitmq需要安装erlang对应的版本</li> <li>2.在 <a href="https://github.com/rabbitmq/erlang-rpm/releases" target="_blank" rel="noopener noreferrer">https://github.com/rabbitmq/erlang-rpm/releases<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 页面找到需要下载的erlang版本，erlang-*.centos.x86_64.rpm就是centos版本的。</li> <li>3.复制下载地址后，使用wget命令下载</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>wget -P /home/download https://github.com/rabbitmq/erlang-rpm/releases/download/v21.2.3/erlang-21.2.3-1.el7.centos.x86_64.rpm
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>4.安装 Erlang</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>sudo rpm -Uvh /home/download/erlang-21.2.3-1.el7.centos.x86_64.rpm
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>5.安装 socat</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>sudo yum install -y socat
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="二、安装rabbitmq"><a href="#二、安装rabbitmq" class="header-anchor">#</a> <a href="#%E4%BA%8C%E3%80%81%E5%AE%89%E8%A3%85RabbitMQ">二、安装RabbitMQ</a></h4> <ul><li>1.在官方下载页面找到CentOS7版本的下载链接，下载rpm安装包</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>wget -P /home/download https://github.com/rabbitmq/rabbitmq-server/releases/download/v3.7.9/rabbitmq-server-3.7.9-1.el7.noarch.rpm
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>提示：可以在<a href="https://github.com/rabbitmq/rabbitmq-server/tags" target="_blank" rel="noopener noreferrer">https://github.com/rabbitmq/rabbitmq-server/tags<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>下载历史版本</p> <ul><li>2.安装RabbitMQ</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>sudo rpm -Uvh /home/download/rabbitmq-server-3.7.9-1.el7.noarch.rpm
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="三、启动和关闭"><a href="#三、启动和关闭" class="header-anchor">#</a> <a href="#%E4%B8%89%E3%80%81%E5%90%AF%E5%8A%A8%E5%92%8C%E5%85%B3%E9%97%AD">三、启动和关闭</a></h4> <ul><li>启动服务</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>sudo systemctl start rabbitmq-server
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>查看状态</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>sudo systemctl status rabbitmq-server
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>停止服务</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>sudo systemctl stop rabbitmq-server
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>设置开机启动</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>sudo systemctl enable rabbitmq-server
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="四、开启web管理插件"><a href="#四、开启web管理插件" class="header-anchor">#</a> <a href="#%E5%9B%9B%E3%80%81%E5%BC%80%E5%90%AFWeb%E7%AE%A1%E7%90%86%E6%8F%92%E4%BB%B6">四、开启Web管理插件</a></h4> <ul><li>1.开启插件</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>rabbitmq-plugins enable rabbitmq_management
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>说明：rabbitmq有一个默认的guest用户，但只能通过localhost访问，所以需要添加一个能够远程访问的用户。</p> <ul><li>2.添加用户</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>rabbitmqctl add_user admin admin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>3.为用户分配操作权限</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>rabbitmqctl set_user_tags admin administrator
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>4.为用户分配资源权限</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>rabbitmqctl set_permissions -p / admin &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="五、防火墙添加端口"><a href="#五、防火墙添加端口" class="header-anchor">#</a> <a href="#%E4%BA%94%E3%80%81%E9%98%B2%E7%81%AB%E5%A2%99%E6%B7%BB%E5%8A%A0%E7%AB%AF%E5%8F%A3">五、防火墙添加端口</a></h4> <p>RabbitMQ 服务启动后，还不能进行外部通信，需要将端口添加都防火墙</p> <ul><li>1.添加端口</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>sudo firewall-cmd --zone=public --add-port=4369/tcp --permanent
sudo firewall-cmd --zone=public --add-port=5672/tcp --permanent
sudo firewall-cmd --zone=public --add-port=25672/tcp --permanent
sudo firewall-cmd --zone=public --add-port=15672/tcp --permanent
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>2.重启防火墙</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>sudo firewall-cmd --reload
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="多机多节点集群部署"><a href="#多机多节点集群部署" class="header-anchor">#</a> <a href="#%E5%A4%9A%E6%9C%BA%E5%A4%9A%E8%8A%82%E7%82%B9%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2">多机多节点集群部署</a></h3> <h4 id="一、-环境准备-一、-环境准备"><a href="#一、-环境准备-一、-环境准备" class="header-anchor">#</a> [一、 环境准备](#一、 环境准备)</h4> <ul><li>准备两台安装好RabbitMQ 的机器，安装方法见 <a href="#RabbitMQ%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8">安装步骤</a> <ul><li>192.168.0.105</li> <li>192.168.0.106</li></ul></li></ul> <p>提示：如果使用虚拟机，可以在一台VM上安装好RabbitMQ后，创建快照，从快照创建链接克隆，会节省很多磁盘空间</p> <h4 id="二、修改配置文件"><a href="#二、修改配置文件" class="header-anchor">#</a> <a href="#%E4%BA%8C%E3%80%81%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">二、修改配置文件</a></h4> <ul><li>1.修改主机名</li></ul> <p>修改/etc/hostname
192.168.0.105 修改为 node1
192.168.0.106 修改为 node2</p> <p>或者
分别在两台主机执行命令</p> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>hostnamectl set-hostname node1
hostnamectl set-hostname node2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>修改完毕后用远程工具重新连接</p> <ul><li>2.修改192.168.0.105机器上的/etc/hosts文件</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>sudo vim /etc/hosts
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>3.添加IP和节点名</li></ul> <div class="language-host line-numbers-mode"><pre class="language-text"><code>192.168.0.105 node1
192.168.0.106 node2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>4.将192.168.0.105上的hosts文件复制到另外一台机器上</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>sudo scp /etc/hosts root@node2:/etc/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>说明：命令中的root是目标机器的用户名，命令执行后，可能会提示需要输入密码，输入对应用户的密码就行了</p> <p>5.将192.168.0.105上的/var/lib/rabbitmq/.erlang.cookie文件复制到另外两台机器上</p> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>scp /var/lib/rabbitmq/.erlang.cookie root@node2:/var/lib/rabbitmq/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>提示：如果是通过克隆的VM，可以省略这一步</p> <h4 id="三、防火墙添加端口"><a href="#三、防火墙添加端口" class="header-anchor">#</a> <a href="#%E4%B8%89%E3%80%81%E9%98%B2%E7%81%AB%E5%A2%99%E6%B7%BB%E5%8A%A0%E7%AB%AF%E5%8F%A3">三、防火墙添加端口</a></h4> <p>给每台机器的防火墙添加端口</p> <ul><li>1.添加端口</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>sudo firewall-cmd --zone=public --add-port=4369/tcp --permanent
sudo firewall-cmd --zone=public --add-port=5672/tcp --permanent
sudo firewall-cmd --zone=public --add-port=25672/tcp --permanent
sudo firewall-cmd --zone=public --add-port=15672/tcp --permanent
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>2.重启防火墙</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>sudo firewall-cmd --reload
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="四、启动rabbitmq"><a href="#四、启动rabbitmq" class="header-anchor">#</a> <a href="#%E5%9B%9B%E3%80%81%E5%90%AF%E5%8A%A8RabbitMQ">四、启动RabbitMQ</a></h4> <ul><li>1.启动每台机器的RabbitMQ</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>sudo systemctl start rabbitmq-server
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>或者</p> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>rabbitmq-server -detached
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>2.将192.168.0.105加入到集群</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code># 停止RabbitMQ 应用
rabbitmqctl stop_app

# 重置RabbitMQ 设置 (可以不操作！！！)
rabbitmqctl reset

# 加入到集群
rabbitmqctl join_cluster rabbit@node1 --ram

# 启动RabbitMQ 应用
rabbitmqctl start_app
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>3.查看集群状态，看到running_nodes,[rabbit@node1,rabbit@node2]表示节点启动成功</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>rabbitmqctl cluster_status
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="单机多节点部署"><a href="#单机多节点部署" class="header-anchor">#</a> <a href="#%E5%8D%95%E6%9C%BA%E5%A4%9A%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2">单机多节点部署</a></h3> <h4 id="一、环境准备"><a href="#一、环境准备" class="header-anchor">#</a> <a href="#%E4%B8%80%E3%80%81%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87">一、环境准备</a></h4> <ul><li>准备一台已经安装好RabbitMQ 的机器，安装方法见 <a href="#RabbitMQ%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8">安装步骤</a></li></ul> <h4 id="二、启动rabbitmq"><a href="#二、启动rabbitmq" class="header-anchor">#</a> <a href="#%E4%BA%8C%E3%80%81%E5%90%AF%E5%8A%A8RabbitMQ">二、启动RabbitMQ</a></h4> <ul><li>1.在启动前，先修改RabbitMQ 的默认节点名（非必要），在/etc/rabbitmq/rabbitmq-env.conf增加以下内容</li></ul> <div class="language-txt line-numbers-mode"><pre class="language-txt"><code># RabbitMQ 默认节点名，默认是rabbit
NODENAME=rabbit1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>2.RabbitMQ 默认是使用服务的启动的，单机多节点时需要改为手动启动，先停止运行中的RabbitMQ 服务</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>sudo systemctl stop rabbitmq-server
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>3.启动第一个节点</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>rabbitmq-server -detached
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>4.启动第二个节点</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>
RABBITMQ_NODE_PORT=5673 RABBITMQ_SERVER_START_ARGS=&quot;-rabbitmq_management listener [{port,15673}]&quot; RABBITMQ_NODENAME=rabbit2 rabbitmq-server -detached
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>5.将rabbit2加入到集群</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code># 停止 rabbit2 的应用
rabbitmqctl -n rabbit2 stop_app

# 重置 rabbit2 的设置
rabbitmqctl -n rabbit2 reset

# rabbit2 节点加入到 rabbit1的集群中
rabbitmqctl -n rabbit2 join_cluster rabbit1 --ram

# 启动 rabbit2 节点
rabbitmqctl -n rabbit2 start_app
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>6.查看集群状态，看到{running_nodes,[rabbit3@node1,rabbit2@node1,rabbit1@node1]}说明节点已启动成功。</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>rabbitmqctl cluster_status
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>提示：在管理界面可以更直观的看到集群信息</p> <h4 id="三、防火墙添加端口-2"><a href="#三、防火墙添加端口-2" class="header-anchor">#</a> <a href="%E4%B8%89%E3%80%81%E9%98%B2%E7%81%AB%E5%A2%99%E6%B7%BB%E5%8A%A0%E7%AB%AF%E5%8F%A3">三、防火墙添加端口</a></h4> <p>需要将每个节点的端口都添加到防火墙</p> <ul><li>1.添加端口</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>sudo firewall-cmd --zone=public --add-port=4369/tcp --permanent
sudo firewall-cmd --zone=public --add-port=5672/tcp --permanent
sudo firewall-cmd --zone=public --add-port=25672/tcp --permanent
sudo firewall-cmd --zone=public --add-port=15672/tcp --permanent
sudo firewall-cmd --zone=public --add-port=5673/tcp --permanent
sudo firewall-cmd --zone=public --add-port=25673/tcp --permanent
sudo firewall-cmd --zone=public --add-port=15673/tcp --permanent
sudo firewall-cmd --zone=public --add-port=5674/tcp --permanent
sudo firewall-cmd --zone=public --add-port=25674/tcp --permanent
sudo firewall-cmd --zone=public --add-port=15674/tcp --permanent
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>2.重启防火墙</li></ul> <div class="language-linux line-numbers-mode"><pre class="language-text"><code>sudo firewall-cmd --reload
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="镜像队列模式集群"><a href="#镜像队列模式集群" class="header-anchor">#</a> <a href="#%E9%95%9C%E5%83%8F%E9%98%9F%E5%88%97%E6%A8%A1%E5%BC%8F%E9%9B%86%E7%BE%A4">镜像队列模式集群</a></h3> <ul><li>镜像队列属于RabbitMQ 的高可用方案，见：<a href="https://www.rabbitmq.com/ha.html#mirroring-arguments" target="_blank" rel="noopener noreferrer">https://www.rabbitmq.com/ha.html#mirroring-arguments<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>通过前面的步骤搭建的集群属于普通模式集群，是通过共享元数据实现集群</li> <li>开启镜像队列模式需要在管理页面添加策略，添加方式：
<ul><li><p>进入管理页面 -&gt; Admin -&gt; Policies（在页面右侧）-&gt; Add / update a policy</p></li> <li><p>b.在表单中填入：</p> <div class="language-txt line-numbers-mode"><pre class="language-txt"><code>name: ha-all
Pattern: ^
Apply to: Queues
Priority: 0
Definition: ha-mode = all
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>参数说明
name: 策略名称，如果使用已有的名称，保存后将会修改原来的信息
Apply to：策略应用到什么对象上
Pattern：策略应用到对象时，对象名称的匹配规则（正则表达式）
Priority：优先级，数值越大，优先级越高，相同优先级取最后一个
Definition：策略定义的类容，对于镜像队列的配置来说，只需要包含3个部分: ha-mode 、ha-params 和 ha-sync-mode。其中，ha-sync-mode是同步的方式，自动还是手动，默认是自动。ha-mode 和 ha-params 组合使用。组合方式如下：</p></li></ul></li></ul> <table><thead><tr><th>ha-mode</th> <th>ha-params</th> <th>说明</th></tr></thead> <tbody><tr><td>all</td> <td>(empty)</td> <td>队列镜像到集群类所有节点</td></tr> <tr><td>exactly</td> <td>count</td> <td>队列镜像到集群内指定数量的节点。如果集群内节点数少于此值，队列将会镜像到所有节点。如果大于此值，而且一个包含镜像的节点停止，则新的镜像不会在其它节点创建。</td></tr> <tr><td>nodes</td> <td>nodename</td> <td>队列镜像到指定节点，指定的节点不在集群中不会报错。当队列申明时，如果指定的节点不在线，则队列会被创建在客户端所连接的节点上。</td></tr></tbody></table> <ul><li>镜像队列模式相比较普通模式，镜像模式会占用更多的带宽来进行同步，所以镜像队列的吞吐量会低于普通模式</li> <li>但普通模式不能实现高可用，某个节点挂了后，这个节点上的消息将无法被消费，需要等待节点启动后才能被消费。</li></ul> <h3 id="rabbitmq持久化机制"><a href="#rabbitmq持久化机制" class="header-anchor">#</a> <a href="#RabbitMQ%E6%8C%81%E4%B9%85%E5%8C%96%E6%9C%BA%E5%88%B6">RabbitMQ持久化机制</a></h3> <h4 id="rabbitmq持久化"><a href="#rabbitmq持久化" class="header-anchor">#</a> <a href="#RabbitMQ%E6%8C%81%E4%B9%85%E5%8C%96">RabbitMQ持久化</a></h4> <ul><li><p>RabbitMQ的持久化分为<strong>队列持久化，消息持久化和交换器持久化</strong>，不管是非持久化和持久化的消息都可以被写入磁盘。
<img src="https://cdn.jsdelivr.net/gh/qouson/my-pic-bed/pic/20210531004345.png" alt="20210531004345"> <img src="https://cdn.jsdelivr.net/gh/qouson/my-pic-bed/pic/20210531232153.png" alt="20210531232153"></p> <ul><li>队列持久化
队列的持久化是在定义队列时的durable参数来实现的，durable为true时，队列才会持久化。</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Connection</span> connection <span class="token operator">=</span> connectionFactory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//第二个参数设置为true，即durable=true </span>
channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;queue1&quot;</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img src="https://cdn.jsdelivr.net/gh/qouson/my-pic-bed/pic/20210601225636.png" alt="20210601225636"></p> <ul><li>消息持久化
消息持久化通过消息的属性deliveryMode来设置是否持久化，在发送消息时通过b asicPublish的参数传入。</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//通过传入MessageProperties.PERSISTENT_TEXT_PLAIN就可以实现消息持久化</span>
channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;queue1&quot;</span><span class="token punctuation">,</span><span class="token class-name">MessageProperties</span><span class="token punctuation">.</span><span class="token constant">PERSISTENT_TEXT_PLAIN</span><span class="token punctuation">,</span>persistent_test_message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>交换器持久化
同队列一样，交换器也需要在定义时设置持久化标识，否则在Broker重启后将丢失</p></li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//durable 为true则开启持久化</span>
<span class="token class-name">Exchange<span class="token punctuation">.</span>DeclareOk</span> <span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token class-name">String</span> exchange，<span class="token class-name">String</span> type，<span class="token keyword">boolean</span> durable<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOE</span> xception<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="rabbitmq内存控制"><a href="#rabbitmq内存控制" class="header-anchor">#</a> RabbitMQ内存控制</h4> <ul><li><p>内存告警</p> <ul><li><p>当内存使用超过配置的阈值或者磁盘剩余空间低于配置的阈值时，RabbitMQ会暂时阻塞客户端的连接，并停止接收从客户端发来的消息，以此避免服务崩溃，客户端与服务端的心跳检测也会失效。
<img src="https://cdn.jsdelivr.net/gh/qouson/my-pic-bed/pic/20210601230931.png" alt="20210601230931"></p></li> <li><p>当出现内存告警时，可以通过管理命令临时调整内存大小，也可以通过修改配置文件</p> <ul><li>命令</li></ul> <div class="language-cmd line-numbers-mode"><pre class="language-text"><code>rabbitmqctl set_vm_memory_high_watermark &lt;fraction&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>fraction 为内存闽值，RabbitMQ默认值为0.4表示当RabbitMQ使用的内存超过40%时，就会产生告警并阻塞所有生产者连接。
通过此命令修改的阈值在Broker重启后将会失效，通过修改配置文件的方式设置的阈值则不会在重启后消失，但需要重启Broker才会生效。</p> <ul><li>配置文件
配置文件地址：/etc/rabbitmq/rabbitmq.conf</li></ul> <div class="language-conf line-numbers-mode"><pre class="language-text"><code>vm_memory_high_watermark.relative = 0.4
#vm_memory_high_watermark.absolute = 1GB
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>RabbitMQ提供relative或absolute两种配置方式
relative 相对值，即前面的fraction，建议取值在0.4~0.66之间，不建议超过0.7
absolute绝对值，单位为KB、MB、GB，对应的命令是</p> <div class="language-cmd line-numbers-mode"><pre class="language-text"><code>rabbitmqctl set_vm_memory_high_watermark absolute &lt;value&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul></li> <li><p>内存换页</p> <ul><li><p>在某个Broker节点触及内存并阻塞生产者之前，它会尝试将队列中的消息换页到磁盘以释放内存空间。持久化和非持久化的消息都会被转储到磁盘中，其中持久化的消息本身就在磁盘中有一份副本，这里会将持久化的消息从内存中清除掉。</p></li> <li><p>默认情况下，在内存到达内存阀值的50%时会进行换页动作。
也就是说，在默认的内存阈值为0.4的情况下，当内存超过0.4×0.5=0.2时会进行换页动作。</p></li> <li><p>可以通过在配置文件中配置vm_memory_high_watermark_paging_ratio项来修
改此值</p> <ul><li>以下配置将会在RabbitMQ内存使用率达到30%时进行换页动作，并在40%时阻塞生产者。
当vm_memory_high_watermark_paging_ratio的值大于1时，相当于禁用了换页功能。</li></ul> <div class="language-cmd line-numbers-mode"><pre class="language-text"><code>vm_memory_high_watermark.relative=0.4
vm_memory_high_watermark_paging_ratio = 0.75
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul></li></ul> <p><img src="https://cdn.jsdelivr.net/gh/qouson/my-pic-bed/pic/20210601230802.png" alt="20210601230802"></p> <h4 id="rabbitmq磁盘控制"><a href="#rabbitmq磁盘控制" class="header-anchor">#</a> RabbitMQ磁盘控制</h4> <ul><li>当磁盘剩余空间低于确定的阀值时，RabbitMQ同样会阻塞生产者，这样可以避免因非持久化的消息持续换页而耗尽磁盘空间导致服务崩渍。
<ul><li><p>默认情况下，磁盘阀值为50MB，表示当磁盘剩余空间低于50MB时会阻塞生产者并停止内存中消息的换页动作。</p></li> <li><p>这个阈值的设置可以减小，但不能完全消除因磁盘耗尽而导致崩溃的可能性。比如在两次磁盘空间检测期间内，磁盘空间从大于50MB被耗尽到0MB。</p></li> <li><p><strong>一个相对谨慎的做法是将磁盘阈值设置为与操作系统所显示的内存大小一致。</strong></p></li> <li><p>通过命令可以临时调整磁盘阀值</p> <div class="language-cmd line-numbers-mode"><pre class="language-text"><code>rabbitmqctl set_disk_free_limit &lt;disk_limit&gt;
rabbitmqctl set_disk_free_limit mem_relative &lt;fraction&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>disk_limit为固定大小，单位为KB、MB、GB fraction为相对比值，建议的取值为1.0~2.0之间对应的配置如下：</li></ul> <div class="language-cmd line-numbers-mode"><pre class="language-text"><code>disk_free_limit.relative=2.0
#disk_free_limit.absolute=50mb
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul></li></ul> <h3 id="消息可靠性和插件化机制"><a href="#消息可靠性和插件化机制" class="header-anchor">#</a> 消息可靠性和插件化机制</h3> <h4 id="消息可靠性"><a href="#消息可靠性" class="header-anchor">#</a> 消息可靠性</h4> <ul><li>RabbitMQ的消息可靠性，一般是业务系统接入消息中间件时首要考虑的问题，一般通过三个方面保障</li> <li>发送可靠性：确保消息成功发送到Broker</li> <li>存储可靠性：Broker对消息持久化，确保消息不会丢失</li> <li>消费可靠性：确保消息成功被消费
<img src="https://cdn.jsdelivr.net/gh/qouson/my-pic-bed/pic/20210601235629.png" alt="20210601235629"></li> <li>**RabbitMQ支持其中的“最多一次”和“最少一次”**其中“最少一次”投递实现需要考虑以下这个几个方面的内容：
<ul><li>“最少一次”
<ul><li>消息生产者需要开启事务机制或者publisher confirm机制，以确保消息可以可靠地传输到RabbitMQ中。</li> <li>消息生产者需要配合使用mandatory参数或者备份交换器来确保消息能够从交换器路由到队列中，进而能够保存下来而不会被丢弃。</li></ul></li> <li>“最多一次”的方式就无须考虑以上那些方面，生产者随意发送，不过这样很难确保消息会成功发送。</li></ul></li></ul> <h5 id="发送可靠性"><a href="#发送可靠性" class="header-anchor">#</a> 发送可靠性</h5> <ul><li><strong>基于mq的分布式事务</strong> <img src="https://cdn.jsdelivr.net/gh/qouson/my-pic-bed/pic/20210601235909.png" alt="20210601235909"></li></ul> <h5 id="消费可靠性"><a href="#消费可靠性" class="header-anchor">#</a> 消费可靠性</h5> <ul><li>消费者在消费消息的同时，需要将autoAck设置为false，然后通过手动确认的方式去确认己经正确消费的消息，以免在消费端引起不必要的消息丢失。</li> <li>死信队列
<img src="https://cdn.jsdelivr.net/gh/qouson/my-pic-bed/pic/20210602000202.png" alt="20210602000202"></li></ul> <h4 id="插件化机制"><a href="#插件化机制" class="header-anchor">#</a> 插件化机制</h4> <ul><li>RabbitMQ支持插件，通过插件可以扩展多种核心功能：支持多种协议、系统状态监控、其它AMQP 0-9-1交换类型、节点联合等。许多功能都是通过插件实现的。</li> <li><strong>RabbitMQ内置一些插件，通过rabbitmq-plugins list命令可以查看插件列表。</strong></li> <li>通过rabbitmq-plugins命令可以启用或禁用插件</li></ul> <div class="language-cmd line-numbers-mode"><pre class="language-text"><code>rabbitmq-plugins enable plugin-name
rabbitmq-plugins disable plugin-name
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>常用插件
<img src="https://cdn.jsdelivr.net/gh/qouson/my-pic-bed/pic/20210602000536.png" alt="20210602000536"> <img src="https://cdn.jsdelivr.net/gh/qouson/my-pic-bed/pic/20210602000611.png" alt="20210602000611"></li></ul></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/qouson/my-java-note/edit/master/docs/30.中间件/30.mq/20.RabbitMQ/10.RabbitMQ.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2024/05/23, 23:50:19</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/8018c5/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">ActiveMQ</div></a> <a href="/pages/68578c/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Kafka</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/8018c5/" class="prev">ActiveMQ</a></span> <span class="next"><a href="/pages/68578c/">Kafka</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/284b7d/"><div>
            springMVC
            <!----></div></a> <span class="date">05-23</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/a78a74/"><div>
            常用命令
            <!----></div></a> <span class="date">05-23</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/8497b8/"><div>
            故障分析
            <!----></div></a> <span class="date">05-23</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:jiangjinchao1642@foxmail.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/qouson" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2023-2024
    <span>qouson</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.a811c800.js" defer></script><script src="/assets/js/2.06722832.js" defer></script><script src="/assets/js/42.4a6de99f.js" defer></script>
  </body>
</html>
